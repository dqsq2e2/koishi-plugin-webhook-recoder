# 更新日志

## v3.2.0

`2025-05-5`

### 新增功能

- ✨ **即时转发控制功能**
  - 新增 `instantForward` 配置选项，可控制是否立即转发webhook消息
  - 默认为 `true`，设置为 `false` 时仅保存消息而不转发
  - 可通过指令单独查询和转发已保存的消息
  - 为高频率webhook提供更好的消息管理

## v3.1.0

`2025-05-05`

### 重大更新

- ✨ **消息持久化存储功能**
  - 新增 `persistMessages` 配置选项，支持将最新消息持久化存储到磁盘
  - 支持 `persistPath` 全局配置，用于指定持久化存储路径
  - 重启机器人后自动从磁盘加载之前保存的消息
  - 防止服务器重启后消息丢失

### 代码优化

- 🛠️ **程序健壮性提升**
  - 改进错误处理机制，提高异常情况下的稳定性
  - 优化文件存取逻辑，防止路径特殊字符问题
  - 完善日志记录，提供更详细的操作信息

## v3.0.0

`2025-05-05`

### 重大更新

- ✨ **标准指令系统支持**
  - 使用 `ctx.command` 替代原来的中间件方式注册指令
  - 所有自定义指令现在都能在指令列表中显示
  - 添加了详细的指令描述和使用帮助
  - 支持使用 `help 命令名` 获取帮助信息

- 🔄 **指令选项支持**
  - 新增 `-p, --path <path>` 选项，用于指定要查询的Webhook路径
    - 例如：`github -p /gitlab` 可查询 `/gitlab` 路径的最新消息
  - 支持 `-h, --help` 选项显示帮助信息
    - 例如：`github -h` 显示指令帮助

- 🌐 **平台特定指令**
  - 新增 `webhook-latest [path]` 命令，只对onebot平台可用
  - 不带参数时列出所有可用的Webhook路径
    - 例如：`webhook-latest` 显示所有可用路径
  - 带路径参数时查询指定路径的最新消息
    - 例如：`webhook-latest /github` 查询GitHub路径的最新消息

## v2.2.4

`2025-05-04`

### 代码优化

- 🛠️ **消息处理逻辑优化**
  - 优化会话ID识别逻辑，更准确地区分群聊和私聊
  - 改进机器人实例获取方式，更安全地处理跨平台消息
  - 修复了路径参数可能为undefined的问题

- 📝 **日志系统改进**
  - 添加更详细的指令执行日志
  - 完善错误处理和提示信息
  - 优化配置读取日志

## v2.2.1

`2025-05-04`

### 改进

- 🐛 修复了启用插件时的"插件已在运行且不可重用"错误
- 🛡️ 增强了类型安全检查，提高了代码健壮性

## v2.2.0

`2025-05-03`

### 功能改进

- ✨ 将自定义指令注册为标准Koishi指令
- 🔄 添加commands依赖，使指令能被@koishijs/plugin-commands管理
- 📋 支持指令描述和帮助信息
- 🔖 支持通过`-p`参数指定路径
- 🧰 完善指令参数和选项处理

## v2.1.0

`2025-05-03`

### 功能改进

- ✨ 完善指令响应系统
- 🔒 指令响应现在严格限制为只回复发送指令的用户或群
- 📝 增加详细的指令处理日志
- 🧩 优化消息会话ID识别逻辑

## v2.0.0

`2025-05-02`

### 新增功能

- ✨ 添加保存最新消息功能
- ✨ 添加通过自定义指令获取最新消息功能
- 🔧 完善类型定义和错误处理
- 📝 更新文档和示例

### 改进

- ♻️ 代码结构优化
- 🐛 修复了配置头检查的问题
- 🚀 改进消息处理逻辑
- 🔍 增强日志输出

## v1.0.0

`2025-05-01`

### 新增功能

- ✨ 基础 webhook 监听功能
- ✨ 支持 GET/POST 请求处理
- ✨ 支持请求头验证
- ✨ 支持消息模板替换
- ✨ 支持多平台机器人消息发送 